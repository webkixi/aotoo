{"version":3,"sources":["suba/lib/combineclass.js"],"names":["createCombinClass","evts","embedPlugins","ctx","extensions","ext","ii","plug","embedActions","inst","actionsLowerCaseNames","item","bind","AotooHoc","oriReactClass","actions","AotooClass","props","evt","dispatch","setComponentState","obj","curState","setState","embeds","originalState","state","liveState","xInst","saxer","_saxer","config","intent","idf","_hasMounted","unMount","call","didUpdate","componentDidMount","_ctx","refs","index","didMount","isClient","isReactNative","renderJsx","render","defaultProps","CombineClass","reactClass","Object","defineProperty","undefined","plugins","eeData","actName","lowerCaseActName","toLowerCase","push","params","pop","append","update","data","key","val","HocClass","x","setProps","on","off","emit","roll","hasOn","set","get","setTimeout","dispatcher","exts","rightValue","id","callback","isServer","React","isValidElement","self","destyory","create","X","container","_props","didMethod","rendered","leaveMethod","leave","browserRender","Aee","document","getElementById","ReactDom","nodeType","control","oState","act","newState","holdDispatchQueue","rctCls","acts"],"mappings":"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","file":"../../../suba/lib/combineclass.js","sourcesContent":["import {\n  noop,\n  uniqueId,\n  objTypeof,\n  isArray,\n  isObject,\n  isDomElement,\n  isFunction,\n  isString,\n\n  // 下面三个是常量\n  isClient,\n  isReactNative,\n  isServer,\n\n  sizeof,\n  merge,\n  forEach,\n  arr2json,\n  deepFind,\n  protectProperty,\n\n  find,\n  findIndex,\n  filter,\n  cloneDeep,\n  sax\n} from './util'\n\nimport {\n  didMount,\n  unMount\n} from './lifecycle'\n\nimport Aee from './aotooeventemitter'\n\n// const evts = ['on', 'off', 'emit', 'roll', 'hasOn', 'pop', 'set', 'get', 'append', 'update', 'bind', 'unbind']\nconst evts = ['on', 'off', 'emit', 'roll', 'hasOn']\n\nfunction embedPlugins(ctx, extensions) {\n  if (isObject(extensions)) {\n    forEach(extensions, (ext, ii) => {\n      const plug = extensions[ext]\n      if (isFunction(plug)) {\n        ctx[ext] = plug\n      }\n    })\n  }\n}\n\nfunction embedActions(ctx, inst) {\n  const actionsLowerCaseNames = inst['_actionMethodlowerCaseNames']\n  forEach(actionsLowerCaseNames, (ii, item)=>{\n    ctx[item] = inst[item].bind(inst)\n  })\n}\n\nfunction AotooHoc(oriReactClass, actions, inst) {\n  class AotooClass extends oriReactClass {\n    constructor(props){\n      super(props)\n\n      forEach(evts, (ii, evt) => {\n        this[evt] = inst::inst[evt]\n      })\n      this.dispatch = inst::inst.dispatch\n      this.setComponentState = function (obj) {\n        if (isObject(obj)) {\n          inst.curState = obj\n          this.setState(obj)\n        }\n      }.bind(this)\n      embedPlugins(this, inst.embeds)   // 绑定外部插件\n      embedActions(this, inst)   // 绑定actions的方法\n      \n      inst.originalState = cloneDeep(this.state||{})\n      inst.liveState = this.state\n      inst.xInst = this\n      // this.saxer = inst\n      this.saxer = inst._saxer(inst)\n      this.config = inst.config\n      this.intent = this.props.intent || this.props.idf || 0;\n    }\n    \n    componentWillUnmount() {\n      inst._hasMounted = false\n      super.componentWillUnmount ? super.componentWillUnmount() : ''\n      inst.unMount.call(inst, this)\n      // opts.leave = opts.leave || this.props.leave\n      // unMount(opts, this.props, queryer)\n    }\n\n    componentDidUpdate() {\n      this.didUpdate = true\n      super.componentDidUpdate ? super.componentDidUpdate() : ''\n      this.componentDidMount()\n    }\n\n    componentDidMount() {\n      inst._hasMounted = true\n      if (this.didUpdate = true) {\n        this.didUpdate = false\n      }\n      const _ctx = {\n        refs: this.refs,\n        index: this.props.idf\n      }\n      inst.refs = this.refs\n      super.componentDidMount ? super.componentDidMount() : ''\n      inst.didMount.call(inst, this)\n    }\n\n    render(){\n      if (isClient || isReactNative) {\n        // if (!inst.fromAotooRender) {\n        //   inst.setProps(merge({}, this.props))\n        //   inst.fromAotooRender = true //如果从<Instance.x {...}/>过来，需要同步一次props，已经同步过一次，不需要再次同步\n        // }\n        return super.render()\n      } else {\n        const renderJsx = super.render()\n        return inst.render(renderJsx)\n      }\n    }\n  }\n\n  AotooClass.defaultProps = {}\n\n  return AotooClass\n}\n\n/**\n * eeData\n * eeActions\n * on, off, emit ...\n */\nexport class CombineClass extends Aee {\n  constructor(reactClass, actions={}, config={}, embeds={}){\n    super(config)\n    this.config = config\n    // this.setProps({\n    //   loaderContext: this,\n    //   eventContext: this\n    // })\n    this.isClient = isClient\n\n    // 是否mounted\n    Object.defineProperty(this, \"_hasMounted\", protectProperty(false));\n    // 原始state数据\n    Object.defineProperty(this, \"originalState\", protectProperty(undefined));\n    // 实时state数据\n    Object.defineProperty(this, \"liveState\", protectProperty(undefined));\n    Object.defineProperty(this, \"curState\", protectProperty(undefined));\n    // 新react class的实例\n    Object.defineProperty(this, \"xInst\", protectProperty(undefined));\n\n    Object.defineProperty(this, \"holdDispatchQueue\", protectProperty([]));\n    // react class 绑定后的方法\n    Object.defineProperty(this, \"didMount\", protectProperty(didMount));\n    // react class 解绑后的方法\n    Object.defineProperty(this, \"unMount\", protectProperty(unMount));\n\n    Object.defineProperty(this, \"_actionMethodlowerCaseNames\", protectProperty([]));\n\n    // 保存actions\n    this.embeds = embeds.plugins\n    if (isObject(actions)) {\n      this.eeData.actions = actions\n      forEach(actions, (actName, ii) => {\n        const lowerCaseActName = '$' + actName.toLowerCase()\n        this['_actionMethodlowerCaseNames'].push(lowerCaseActName)\n        this[lowerCaseActName] = function(params) {\n          this.dispatch(actName, params)\n          return this\n        }\n      })\n    }\n\n    // 剔除AotooEventEmitter的数据处理方法\n    // 使用data的方法代替以下方法\n    this.pop = undefined\n    // this.set = undefined\n    // this.get = undefined\n    this.append = undefined\n    this.update = undefined\n\n    this.data = function(key, val) {\n      if (!key) {\n        return this.eeData\n      }\n\n      if (isString(key)) {\n        if (!val) {\n          return this.eeData[key]\n        } else {\n          this.eeData[key] = val\n          return this\n        }\n      }\n\n      if (isObject(key)) {\n        if (val === true) {\n          this.eeData = key\n        } else {\n          this.eeData = merge(this.eeData, key)\n        }\n      }\n    }\n\n    this.saxer = this._saxer(this)\n    // this.x = AotooHoc(reactClass, actions, this)\n    this.HocClass = AotooHoc(reactClass, actions, this)\n    this.x = function(props={}) {\n      this.setProps(props)\n      return this.render()\n    }.bind(this)\n  }\n\n  _saxer(ctx){\n    return {\n      on:     this.on.bind(ctx),\n      off:    this.off.bind(ctx),\n      emit:   this.emit.bind(ctx),\n      roll:   this.roll.bind(ctx),\n      hasOn:  this.hasOn.bind(ctx),\n      set:    this.data.bind(ctx),\n      get:    this.data.bind(ctx),\n      append: this.data.bind(ctx),\n      update: this.data.bind(ctx),\n      data:   this.data.bind(ctx)\n    }\n  }\n\n  getState(){\n    // return this.liveState\n    return this.curState||this.liveState\n  }\n\n  dispatch(key, params){\n    if (isClient) {\n      setTimeout(() => {\n        dispatcher(key, params, this)\n      }, 0);\n    }\n  }\n\n  hasMounted(){\n    return this._hasMounted\n  }\n\n  extend(exts) {\n    if (typeof exts == 'object') {\n      forEach(exts, (key, ii) => {\n        const rightValue = exts[key]\n        if (isFunction(rightValue)) {\n          this[key] = rightValue.bind(this)\n        } else {\n          this[key] = rightValue\n        }\n      })\n    }\n  }\n\n  setConfig(config) {\n    this.config = config || {}\n    return this\n  }\n\n  setProps(props) {\n    // this.config.props = props\n    this.config.props = merge({}, this.config.props, props)\n    return this\n  }\n\n  render(id, callback){\n    if (isServer && id && React.isValidElement(id)) {\n      const self = this\n      setTimeout(() => {\n        self.destyory()\n        self.xInst = Object.create(null)\n        self.curState = Object.create(null)\n        self.liveState = Object.create(null)\n        self.originalState = Object.create(null)\n        self.config = Object.create(null)\n        self.x = Object.create(null)\n        self.HocClass = Object.create(null)\n      }, 100);\n      return id\n    } else {\n      // const X = this.x\n      const X = this.HocClass\n  \n      if (isFunction(id)) {\n        callback = id\n        id = undefined\n      }\n  \n      id = id || this.config.container\n  \n      let _props = this.config.props || {}\n      let didMethod = callback || this.rendered || _props.rendered || this.config.rendered\n      _props.rendered = didMethod\n  \n      let leaveMethod = _props.leave || this.config.leave || this.leave\n      _props.leave = leaveMethod\n      this.config.props = _props\n  \n      if (isClient) {\n        this.config.container = id\n        return browserRender(id, X, this.config)\n      } else {\n        return <X {..._props} />\n      }\n    }\n  }\n}\n\nfunction browserRender(id, X, config) {\n  const props = config.props\n  if (isString(id)) {\n    if (document.getElementById(id)) {\n      ReactDom.render(<X {...props} />, document.getElementById(id))\n    }\n  } else if (typeof id === 'object' && id.nodeType) {\n  // } else if (isObject(id) && id.nodeType) {\n    ReactDom.render(<X {...props} />, id)\n  } else {\n    return <X {...props} />\n  }\n}\n\n/**\n * type 2\n * ComposedComponent 为 React class\n * @type {[type]}\n */\n// let curState = undefined\nfunction dispatcher(key, params, control) {\n  const xInst = control.xInst\n  if (xInst) {\n    const oState = control.originalState\n    // let curState = curState || cloneDeep(xInst.state)\n    let curState = control.curState || cloneDeep(xInst.state)\n    const actions = control.data('actions')\n    // actions.curState = curState\n    const act = actions[key]\n    if (isFunction(act)) {\n      let newState = act.call({curState: curState}, oState, params, control)\n      if (isObject(newState)) {\n        control.curState = newState\n        if (control._hasMounted) {\n          control._hasMounted = false\n          // curState = undefined\n          xInst.setState(newState)\n        } else {\n          control.holdDispatchQueue.push(newState)\n        }\n      }\n    }\n  } else {\n    control.holdDispatchQueue.push([key, params])\n  }\n}\n\nexport function createCombinClass(rctCls, acts = {}, config, embeds) {\n  // if (isClient) {\n  //   const globalName = uniqueId('Combinex_')\n  //   instanceCollection[globalName] = new CombineClass(config, rctCls, acts, exts, globalName)\n  //   return instanceCollection[globalName]\n  // } else {\n  //   return createServerClass(config, rctCls, acts, exts)\n  // }\n\n  return new CombineClass(rctCls, acts, config, embeds)\n}"]}