{"version":3,"sources":["suba/lib/lifecycle.js"],"names":["didMount","unMount","findDOMNode","ReactDom","ctx","rcInst","opts","componentCtx","isClient","window","global","holdDispatchQueue","length","newState","reduce","p","n","key","param","actions","data","oState","originalState","curState","state","act","call","setState","didMethod","props","rendered","itemMethod","config","dom","refs","index","idf","context","on","emit","off","intent","operat","destory","noop","leaveFunction","leave","xInst","Object","create","liveState"],"mappings":"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","file":"../../../suba/lib/lifecycle.js","sourcesContent":["import {\n  noop,\n  uniqueId,\n  objTypeof,\n  isArray,\n  isObject,\n  isFunction,\n  isString,\n  // 下面三个是常量\n  isClient,\n  isReactNative,\n  isServer,\n\n  sizeof,\n  merge,\n  forEach,\n  arr2json,\n  deepFind,\n  protectProperty,\n\n  find,\n  findIndex,\n  filter,\n  cloneDeep,\n  sax\n} from './util'\n\nconst findDOMNode = ReactDom.findDOMNode || function (ctx) { return ctx }\n\n/**\n * \n * @param {Object} rcInst:  ReactClass的实例\n */\nexport function didMount(rcInst, opts) {\n  var componentCtx = {}\n  if (this && rcInst) {\n    if ((isClient && this !== window) || (!isClient && this !== global)) {\n      if (this.holdDispatchQueue && this.holdDispatchQueue.length) {\n        const newState = this.holdDispatchQueue.reduce((p, n) => {\n          if (isArray(n)) {\n            const key = n[0]\n            const param = n[1]\n            const actions = this.data('actions')\n            let oState = this.originalState\n            let curState = this.curState || cloneDeep(rcInst.state)\n            const act = actions[key]\n            if (isFunction(act)) {\n              n = act.call({curState}, oState, param, this)\n            } else {\n              n = {}\n            }\n          }\n          return merge(p, n)\n        }, {})\n        this.holdDispatchQueue = []\n        this.curState = newState\n        rcInst.setState(newState)\n        return \n      } \n    \n      // if ((typeof window !== 'undefined' && this !== window) || (typeof global !== 'undefined' && this !== global)) {\n      const didMethod = rcInst.props.rendered || rcInst.props.itemMethod || this.rendered || this.config.rendered\n      componentCtx = {\n        dom: findDOMNode(rcInst),\n        refs: rcInst.refs,\n        index: rcInst.props.idf,\n        context: this,\n        ctx: this\n      }\n\n      if (isFunction(rcInst.on)) {\n        rcInst.emit('beforeRendered', componentCtx)\n        rcInst.emit('__beforeRendered', componentCtx)\n        rcInst.emit('_beforeRendered', componentCtx)\n        rcInst.off('__beforeRendered')\n        rcInst.off('_beforeRendered')\n      }\n\n      if (isFunction(didMethod)) {\n        didMethod.call(this, componentCtx.dom, rcInst.intent)\n      }\n  \n      if (isFunction(rcInst.on)) {\n        rcInst.emit('rendered', componentCtx)\n        rcInst.emit('__rendered', componentCtx)\n        rcInst.emit('_rendered', componentCtx)\n        rcInst.off('__rendered')\n        rcInst.off('_rendered')\n      }\n    }\n  }\n}\n\n/**\n * \n * @param {Object} rcInst ReactClass的实例\n */\nexport function unMount(rcInst) {\n  /** destory some thing */\n  const operat = {\n    destory: noop\n  }\n  const leaveFunction = rcInst.props.leave || rcInst.config.leave\n  if (isFunction(leaveFunction)) {\n    leaveFunction(operat)\n  }\n  if (this && this.destory) {\n    this.destory()\n    this.xInst = Object.create(null)\n    this.curState = Object.create(null)\n    this.liveState = Object.create(null)\n    this.originalState = Object.create(null)\n    this.config = Object.create(null)\n  }\n}"]}