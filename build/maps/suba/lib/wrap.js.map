{"version":3,"sources":["suba/lib/wrap.js"],"names":["wrap","_combineX","ComposedComponent","opts","cb","returnReactClass","type","undefined","React","isValidElement","dealWithReactElement","dealWithReactClass","CComponent","props","config","intent","dom","rendered","ctx","call","_ctx","didMount","that","evts","_props","Object","keys","forEach","key","indexOf","e","cloneElement","ref","PureComponent","Component","combineX"],"mappings":"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","file":"../../../suba/lib/wrap.js","sourcesContent":["import {\n  noop,\n  uniqueId,\n  objTypeof,\n  isArray,\n  isObject,\n  isFunction,\n  isString,\n  isClient,\n  isReactNative,\n  sizeof,\n  merge,\n  forEach,\n  arr2json,\n  deepFind,\n  protectProperty,\n\n  find,\n  findIndex,\n  filter,\n  cloneDeep,\n  sax\n} from './util'\n\nimport {\n  didMount,\n  unMount\n} from './lifecycle'\n\n/**\n * [combineX description]\n * @param  {react class | react element}   ComposedComponent [description]\n * @param  {object}   opts              [description]\n * @param  {Function} cb                [description]\n * @return {react class | object}       [description]\n */\nfunction _combineX(ComposedComponent, opts, cb) {\n  if (isFunction(ComposedComponent) || isObject(ComposedComponent)) {\n    let returnReactClass = false\n    if (isObject(opts) && opts.type == 'reactClass') {\n      returnReactClass = true\n      opts.type = undefined\n    }\n\n    if (React.isValidElement(ComposedComponent)) {\n      return dealWithReactElement(ComposedComponent, opts, cb)\n    }\n\n    if (returnReactClass) {\n      return dealWithReactClass( ComposedComponent, opts, cb )\n    }\n  }\n}\n\n/**\n * [dealWithReactElement 处理传入为react element 的场景，一般用于wrap]\n * @param  {react element} CComponent [description]\n * @return {react class}            [description]\n */\nfunction dealWithReactElement(CComponent, opts = {}, cb) {\n  return class extends (React.PureComponent || React.Component) {\n    constructor(props) {\n      super(props)\n      this.config = opts\n      this.intent = this.props.intent\n      this.dom\n      // this.rendered = cb\n      this.rendered = function(dom, intent) {\n        const ctx = this\n        if (isFunction(cb)) {\n          cb.call(ctx, dom, intent)\n        } else {\n          if (isObject(opts) && isFunction(opts.rendered)) {\n            opts.rendered.call(ctx, dom, intent)\n          }\n        }\n      }\n    }\n\n    componentWillUnmount() {\n      unMount(this)\n      // unMount(opts, this.props)\n    }\n\n    componentDidMount() {\n      const _ctx = {}\n      super.componentDidMount ? super.componentDidMount() : ''\n      didMount.call(this, this, opts)\n    }\n\n    render() {\n      let that = this\n      let props = {}, evts = {}\n      let _props = merge({}, opts.props, this.props)\n      Object.keys(_props).forEach(key=>{\n        if (key.indexOf('on') == 0 ) {\n          if (isFunction(_props[key])) {\n            evts[key] = function(e) {\n              _props[key].call(that.dom, e, that.config)\n            }\n          }\n        } else {\n          props[key] = _props[key]\n        }\n      })\n      return React.cloneElement(CComponent, {...props, ...evts, ref:ref=>this.dom=ref })\n    }\n  }\n}\n\nfunction dealWithReactClass(CComponent, opts = {}, cb) {\n  return class extends CComponent {\n    constructor(props) {\n      super(props)\n      this.config = opts\n      this.intent = this.props.intent\n      // this.rendered = cb\n      this.rendered = function (dom, intent) {\n        const ctx = this\n        if (isFunction(cb)) {\n          cb.call(ctx, dom, intent)\n        } else {\n          if (isObject(opts) && isFunction(opts.rendered)) {\n            opts.rendered.call(ctx, dom, intent)\n          }\n        }\n      }\n    }\n\n    componentWillUnmount() {\n      super.componentWillUnmount ? super.componentWillUnmount() : ''\n      unMount(this)\n      // unMount(opts, this.props)\n    }\n\n    componentDidMount() {\n      super.componentDidMount ? super.componentDidMount() : ''\n      didMount.call(this, this, opts)\n    }\n  }\n}\n\nexport function wrap(ComposedComponent, opts, cb) {\n  opts = opts || { type: 'reactClass' }\n  if (isObject(opts)) {\n    opts.type = 'reactClass'\n  }\n\n  if (isFunction(opts)) {\n    cb = opts\n    opts = { type: 'reactClass' }\n  }\n\n  return _combineX(ComposedComponent, opts, cb)\n}\n\nexport const combineX = wrap"]}